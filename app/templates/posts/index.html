{% extends "base.html" %}
{% from "components/post_card.html" import post_card %}

{% block title %}Posts - PostForge{% endblock %}

{% block content %}
<div class="mb-8">
    <div class="flex justify-between items-center">
        <h1 class="text-3xl font-bold text-gray-900">Posts</h1>
        <a href="{{ url_for('posts.create') }}" class="btn-primary">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
            </svg>
            Neuen Post erstellen
        </a>
    </div>
</div>

<!-- Search and Filter -->
<div class="card mb-6">
    <div class="p-6">
        <form method="GET" class="flex flex-col md:flex-row gap-4">
            <div class="flex-1">
                <input type="text" 
                       name="query" 
                       value="{{ search_query }}" 
                       placeholder="Posts durchsuchen..." 
                       class="form-input">
            </div>
            
            <div class="w-full md:w-48">
                <select name="status_filter" class="form-input">
                    <option value="all" {% if status_filter == 'all' %}selected{% endif %}>Alle Status</option>
                    <option value="draft" {% if status_filter == 'draft' %}selected{% endif %}>Entwürfe</option>
                    <option value="posted" {% if status_filter == 'posted' %}selected{% endif %}>Veröffentlicht</option>
                    <option value="imported" {% if status_filter == 'imported' %}selected{% endif %}>Importiert</option>
                    <option value="scheduled" {% if status_filter == 'scheduled' %}selected{% endif %}>Geplant</option>
                </select>
            </div>
            
            <button type="submit" class="btn-primary">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
                Suchen
            </button>
        </form>
    </div>
</div>

<!-- Posts List -->
<div id="posts-container">
    {% if posts.items %}
        {% for post in posts.items %}
            {{ post_card(post) }}
        {% endfor %}
        
        <!-- Pagination -->
        {% if posts.pages > 1 %}
            <div class="flex justify-center mt-8">
                <nav class="flex items-center space-x-2">
                    {% if posts.has_prev %}
                        <a href="{{ url_for('posts.index', page=posts.prev_num, query=search_query, status_filter=status_filter) }}" 
                           class="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50">
                            Zurück
                        </a>
                    {% endif %}
                    
                    {% for page_num in posts.iter_pages() %}
                        {% if page_num %}
                            {% if page_num != posts.page %}
                                <a href="{{ url_for('posts.index', page=page_num, query=search_query, status_filter=status_filter) }}" 
                                   class="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50">
                                    {{ page_num }}
                                </a>
                            {% else %}
                                <span class="px-3 py-2 text-sm font-medium text-blue-600 bg-blue-50 border border-blue-300 rounded-md">
                                    {{ page_num }}
                                </span>
                            {% endif %}
                        {% else %}
                            <span class="px-3 py-2 text-sm font-medium text-gray-500">…</span>
                        {% endif %}
                    {% endfor %}
                    
                    {% if posts.has_next %}
                        <a href="{{ url_for('posts.index', page=posts.next_num, query=search_query, status_filter=status_filter) }}" 
                           class="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50">
                            Weiter
                        </a>
                    {% endif %}
                </nav>
            </div>
        {% endif %}
    {% else %}
        <div class="card">
            <div class="p-8 text-center">
                <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                <h3 class="text-lg font-medium text-gray-900 mb-2">
                    {% if search_query or status_filter != 'all' %}
                        Keine Posts gefunden
                    {% else %}
                        Keine Posts vorhanden
                    {% endif %}
                </h3>
                <p class="text-gray-600 mb-4">
                    {% if search_query or status_filter != 'all' %}
                        Versuchen Sie eine andere Suche oder Filter-Einstellung.
                    {% else %}
                        Erstellen Sie Ihren ersten Post oder importieren Sie Posts aus einer PDF-Datei.
                    {% endif %}
                </p>
                
                {% if not search_query and status_filter == 'all' %}
                    <div class="space-x-4">
                        <a href="{{ url_for('posts.create') }}" class="btn-primary">
                            Post erstellen
                        </a>
                        <a href="{{ url_for('upload.import_pdf') }}" class="btn-secondary">
                            PDF importieren
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(function() {
        // Show success notification
        const notification = document.createElement('div');
        notification.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded shadow-lg z-50';
        notification.textContent = 'In Zwischenablage kopiert!';
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.remove();
        }, 3000);
    });
}
</script>
{% endblock %}